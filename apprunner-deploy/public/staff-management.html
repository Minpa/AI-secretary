<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Secretary - ì¸ë ¥ ê´€ë¦¬</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="gradient-bg shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-xl font-bold text-white">ğŸ¢ AI Secretary</h1>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <a href="/" class="text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium">í™ˆ</a>
                            <a href="/dashboard.html" class="text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium">ëŒ€ì‹œë³´ë“œ</a>
                            <a href="/reports.html" class="text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium">ë¦¬í¬íŠ¸</a>
                            <a href="/workload.html" class="text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium">ì—…ë¬´ í˜„í™©</a>
                            <a href="/staff-management.html" class="bg-blue-700 text-white px-3 py-2 rounded-md text-sm font-medium">ì¸ë ¥ ê´€ë¦¬</a>
                            <a href="/test.html" class="text-white hover:bg-blue-700 px-3 py-2 rounded-md text-sm font-medium">í…ŒìŠ¤íŠ¸</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <h2 class="text-3xl font-bold text-gray-900">ğŸ‘¥ ì¸ë ¥ ê´€ë¦¬</h2>
            <p class="mt-2 text-gray-600">ì§ì› ì •ë³´ë¥¼ ì¶”ê°€, ìˆ˜ì •, ì‚­ì œí•˜ê³  ì „ë¬¸ ë¶„ì•¼ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>

        <!-- Add New Staff Section -->
        <div class="bg-white shadow rounded-lg mb-8">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">â• ìƒˆ ì§ì› ì¶”ê°€</h3>
            </div>
            <div class="px-6 py-4">
                <form id="addStaffForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë¦„</label>
                        <input type="text" id="staffName" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                               placeholder="í™ê¸¸ë™" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì—­í• </label>
                        <input type="text" id="staffRole" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                               placeholder="ì‹œì„¤ê´€ë¦¬" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì „ë¬¸ ë¶„ì•¼</label>
                        <select id="staffSpecialties" class="w-full px-3 py-2 border border-gray-300 rounded-md" multiple>
                            <option value="maintenance">ì‹œì„¤ê´€ë¦¬</option>
                            <option value="billing">ê´€ë¦¬ë¹„</option>
                            <option value="security">ë³´ì•ˆ</option>
                            <option value="parking">ì£¼ì°¨</option>
                            <option value="noise">ì†ŒìŒ</option>
                            <option value="complaint">ë¯¼ì›</option>
                            <option value="inquiry">ë¬¸ì˜</option>
                            <option value="facility">ì‹œì„¤</option>
                        </select>
                        <p class="text-xs text-gray-500 mt-1">Ctrl/Cmd í‚¤ë¥¼ ëˆ„ë¥´ê³  ì—¬ëŸ¬ í•­ëª© ì„ íƒ</p>
                    </div>
                    <div class="flex items-end">
                        <button type="submit" class="w-full bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700">
                            ì§ì› ì¶”ê°€
                        </button>
                    </div>
                </form>
                <div id="addStaffResult" class="mt-4 hidden"></div>
            </div>
        </div>

        <!-- Staff List -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">ğŸ‘¤ ì§ì› ëª©ë¡</h3>
            </div>
            <div class="px-6 py-4">
                <!-- Loading State -->
                <div id="loadingState" class="text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
                    <p class="mt-2 text-gray-600">ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                </div>

                <!-- Staff Cards -->
                <div id="staffList" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Staff cards will be populated here -->
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="hidden text-center py-12">
                    <div class="text-gray-400 text-6xl mb-4">ğŸ‘¥</div>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p class="text-gray-600">ìœ„ì˜ ì–‘ì‹ì„ ì‚¬ìš©í•˜ì—¬ ì²« ë²ˆì§¸ ì§ì›ì„ ì¶”ê°€í•˜ì„¸ìš”.</p>
                </div>

                <!-- Error State -->
                <div id="errorState" class="hidden text-center py-12">
                    <div class="text-red-600 text-4xl mb-4">âš ï¸</div>
                    <h3 class="text-lg font-bold text-gray-900 mb-2">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
                    <p class="text-gray-600 mb-4" id="errorMessage">ì„œë²„ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.</p>
                    <button id="retryBtn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                        ë‹¤ì‹œ ì‹œë„
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Staff Modal -->
    <div id="editStaffModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden" style="z-index: 9999;">
        <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <!-- Modal Header -->
                <div class="flex justify-between items-center pb-3 border-b">
                    <h3 class="text-lg font-medium text-gray-900">âœï¸ ì§ì› ì •ë³´ ìˆ˜ì •</h3>
                    <button id="closeEditModal" class="text-gray-400 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <!-- Modal Content -->
                <div class="mt-4">
                    <form id="editStaffForm" class="space-y-4">
                        <input type="hidden" id="editStaffId">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë¦„</label>
                            <input type="text" id="editStaffName" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì—­í• </label>
                            <input type="text" id="editStaffRole" class="w-full px-3 py-2 border border-gray-300 rounded-md" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì „ë¬¸ ë¶„ì•¼</label>
                            <select id="editStaffSpecialties" class="w-full px-3 py-2 border border-gray-300 rounded-md" multiple>
                                <option value="maintenance">ì‹œì„¤ê´€ë¦¬</option>
                                <option value="billing">ê´€ë¦¬ë¹„</option>
                                <option value="security">ë³´ì•ˆ</option>
                                <option value="parking">ì£¼ì°¨</option>
                                <option value="noise">ì†ŒìŒ</option>
                                <option value="complaint">ë¯¼ì›</option>
                                <option value="inquiry">ë¬¸ì˜</option>
                                <option value="facility">ì‹œì„¤</option>
                            </select>
                        </div>
                        <div class="flex justify-end space-x-3 pt-4">
                            <button type="button" id="cancelEditBtn" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400">
                                ì·¨ì†Œ
                            </button>
                            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                                ì €ì¥
                            </button>
                        </div>
                    </form>
                    <div id="editStaffResult" class="mt-4 hidden"></div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .staff-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .staff-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
    </style>

    <script>
        let staffData = [];

        // Load staff data on page load
        document.addEventListener('DOMContentLoaded', loadStaffData);

        async function loadStaffData() {
            try {
                showLoading();
                
                const response = await fetch('/api/tickets/staff');
                const result = await response.json();
                
                if (result.success) {
                    staffData = result.data;
                    displayStaffList();
                } else {
                    showError('ì§ì› ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('Error loading staff data:', error);
                showError('ì„œë²„ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.');
            }
        }

        function showLoading() {
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('staffList').classList.add('hidden');
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('errorState').classList.add('hidden');
        }

        function showError(message) {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('staffList').classList.add('hidden');
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('errorState').classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
        }

        function displayStaffList() {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('errorState').classList.add('hidden');
            
            if (staffData.length === 0) {
                document.getElementById('emptyState').classList.remove('hidden');
                document.getElementById('staffList').classList.add('hidden');
                return;
            }
            
            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('staffList').classList.remove('hidden');
            
            const staffListContainer = document.getElementById('staffList');
            staffListContainer.innerHTML = '';
            
            staffData.forEach(staff => {
                const card = createStaffCard(staff);
                staffListContainer.appendChild(card);
            });
        }

        function createStaffCard(staff) {
            const card = document.createElement('div');
            card.className = 'staff-card bg-white border rounded-lg p-6 shadow-sm';
            
            const specialtyLabels = {
                'maintenance': 'ì‹œì„¤ê´€ë¦¬',
                'billing': 'ê´€ë¦¬ë¹„',
                'security': 'ë³´ì•ˆ',
                'parking': 'ì£¼ì°¨',
                'noise': 'ì†ŒìŒ',
                'complaint': 'ë¯¼ì›',
                'inquiry': 'ë¬¸ì˜',
                'facility': 'ì‹œì„¤'
            };
            
            const specialtiesText = staff.specialties.map(s => specialtyLabels[s] || s).join(', ');
            
            card.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold text-lg">
                            ${staff.name.charAt(0)}
                        </div>
                        <div>
                            <h4 class="text-lg font-medium text-gray-900">${staff.name}</h4>
                            <p class="text-sm text-gray-600">${staff.role}</p>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="editStaff('${staff.id}')" class="text-blue-600 hover:text-blue-800 p-1">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                        </button>
                        <button onclick="deleteStaff('${staff.id}', '${staff.name}')" class="text-red-600 hover:text-red-800 p-1">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="mb-3">
                    <dt class="text-sm font-medium text-gray-500">ì „ë¬¸ ë¶„ì•¼</dt>
                    <dd class="mt-1 text-sm text-gray-900">${specialtiesText}</dd>
                </div>
                
                <div class="text-xs text-gray-500">
                    ID: ${staff.id}
                </div>
            `;
            
            return card;
        }

        // Add new staff
        document.getElementById('addStaffForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('staffName').value;
            const role = document.getElementById('staffRole').value;
            const specialtiesSelect = document.getElementById('staffSpecialties');
            const specialties = Array.from(specialtiesSelect.selectedOptions).map(option => option.value);
            
            if (specialties.length === 0) {
                showResult('addStaffResult', { error: 'ìµœì†Œ í•˜ë‚˜ì˜ ì „ë¬¸ ë¶„ì•¼ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.' }, true);
                return;
            }
            
            try {
                const response = await fetch('/api/tickets/staff', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, role, specialties })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResult('addStaffResult', { message: 'ì§ì›ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.' }, false);
                    document.getElementById('addStaffForm').reset();
                    loadStaffData(); // Refresh the list
                } else {
                    showResult('addStaffResult', result, true);
                }
            } catch (error) {
                showResult('addStaffResult', { error: 'ì§ì› ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' }, true);
            }
        });

        // Edit staff
        function editStaff(staffId) {
            const staff = staffData.find(s => s.id === staffId);
            if (!staff) return;
            
            document.getElementById('editStaffId').value = staff.id;
            document.getElementById('editStaffName').value = staff.name;
            document.getElementById('editStaffRole').value = staff.role;
            
            // Set selected specialties
            const specialtiesSelect = document.getElementById('editStaffSpecialties');
            Array.from(specialtiesSelect.options).forEach(option => {
                option.selected = staff.specialties.includes(option.value);
            });
            
            document.getElementById('editStaffModal').classList.remove('hidden');
        }

        document.getElementById('editStaffForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const id = document.getElementById('editStaffId').value;
            const name = document.getElementById('editStaffName').value;
            const role = document.getElementById('editStaffRole').value;
            const specialtiesSelect = document.getElementById('editStaffSpecialties');
            const specialties = Array.from(specialtiesSelect.selectedOptions).map(option => option.value);
            
            try {
                const response = await fetch(`/api/tickets/staff/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, role, specialties })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResult('editStaffResult', { message: 'ì§ì› ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' }, false);
                    setTimeout(() => {
                        document.getElementById('editStaffModal').classList.add('hidden');
                        loadStaffData(); // Refresh the list
                    }, 1500);
                } else {
                    showResult('editStaffResult', result, true);
                }
            } catch (error) {
                showResult('editStaffResult', { error: 'ì§ì› ì •ë³´ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' }, true);
            }
        });

        // Delete staff
        async function deleteStaff(staffId, staffName) {
            if (!confirm(`ì •ë§ë¡œ "${staffName}" ì§ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, í•´ë‹¹ ì§ì›ì—ê²Œ í• ë‹¹ëœ ëª¨ë“  í‹°ì¼“ì€ ë¯¸í• ë‹¹ ìƒíƒœê°€ ë©ë‹ˆë‹¤.`)) {
                return;
            }
            
            try {
                const response = await fetch(`/api/tickets/staff/${staffId}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('ì§ì›ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    loadStaffData(); // Refresh the list
                } else {
                    alert('ì§ì› ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ì§ì› ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // Modal controls
        document.getElementById('closeEditModal').addEventListener('click', () => {
            document.getElementById('editStaffModal').classList.add('hidden');
        });

        document.getElementById('cancelEditBtn').addEventListener('click', () => {
            document.getElementById('editStaffModal').classList.add('hidden');
        });

        // Retry button
        document.getElementById('retryBtn').addEventListener('click', loadStaffData);

        // Utility function for showing results
        function showResult(elementId, data, isError) {
            const element = document.getElementById(elementId);
            element.className = `mt-4 p-4 rounded-md ${isError ? 'bg-red-50 border border-red-200' : 'bg-green-50 border border-green-200'}`;
            element.innerHTML = `<pre class="text-sm ${isError ? 'text-red-800' : 'text-green-800'}">${data.error || data.message || JSON.stringify(data, null, 2)}</pre>`;
            element.classList.remove('hidden');
            
            // Auto-hide success messages
            if (!isError) {
                setTimeout(() => {
                    element.classList.add('hidden');
                }, 3000);
            }
        }
    </script>
</body>
</html>