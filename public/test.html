<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Secretary - 시스템 테스트</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="gradient-bg shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="/" class="text-white text-xl font-bold">AI Secretary</a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-white hover:text-gray-200 px-3 py-2 rounded-md">홈</a>
                    <a href="/dashboard" class="text-white hover:text-gray-200 px-3 py-2 rounded-md">대시보드</a>
                    <a href="/reports" class="text-white hover:text-gray-200 px-3 py-2 rounded-md">리포트</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900">시스템 테스트</h1>
            <p class="mt-2 text-gray-600">AI Secretary의 다양한 기능을 테스트해보세요</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- SMS Test -->
            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">📱 SMS 접수 테스트</h2>
                <form id="smsForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">발신번호</label>
                        <input type="text" id="smsFrom" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                               placeholder="010-1234-5678" value="010-1234-5678">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">메시지 내용</label>
                        <textarea id="smsBody" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                                  placeholder="엘리베이터가 고장났어요">엘리베이터가 고장났어요</textarea>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700">
                        SMS 전송 테스트
                    </button>
                </form>
                <div id="smsResult" class="mt-4 hidden"></div>
            </div>

            <!-- Email Test -->
            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">📧 이메일 접수 테스트</h2>
                <form id="emailForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">발신자</label>
                        <input type="email" id="emailFrom" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                               placeholder="resident@example.com" value="resident@example.com">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">제목</label>
                        <input type="text" id="emailSubject" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                               placeholder="소음 민원" value="소음 민원">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">내용</label>
                        <textarea id="emailBody" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                                  placeholder="윗집 소음이 심합니다">윗집 소음이 심합니다</textarea>
                    </div>
                    <button type="submit" class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700">
                        이메일 전송 테스트
                    </button>
                </form>
                <div id="emailResult" class="mt-4 hidden"></div>
            </div>

            <!-- Web Form Test -->
            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">🌐 웹폼 접수 테스트</h2>
                <form id="webForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">이름</label>
                        <input type="text" id="webName" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                               placeholder="홍길동" value="홍길동">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">이메일</label>
                        <input type="email" id="webEmail" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                               placeholder="hong@example.com" value="hong@example.com">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">문의 내용</label>
                        <textarea id="webMessage" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                                  placeholder="주차장 문제가 있습니다">주차장 문제가 있습니다</textarea>
                    </div>
                    <button type="submit" class="w-full bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700">
                        웹폼 제출 테스트
                    </button>
                </form>
                <div id="webResult" class="mt-4 hidden"></div>
            </div>

            <!-- Call Test -->
            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">📞 통화 기록 테스트</h2>
                <form id="callForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">발신번호</label>
                        <input type="text" id="callCaller" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                               placeholder="010-9876-5432" value="010-9876-5432">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">통화 시간 (분)</label>
                        <input type="number" id="callDuration" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                               placeholder="5" value="5">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">통화 내용 (음성인식)</label>
                        <textarea id="callTranscript" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                                  placeholder="관리비 문의드립니다">관리비 문의드립니다</textarea>
                    </div>
                    <button type="submit" class="w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">
                        통화 기록 테스트
                    </button>
                </form>
                <div id="callResult" class="mt-4 hidden"></div>
            </div>
        </div>

        <!-- Message Status Management -->
        <div class="mt-8 bg-white shadow rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">📋 메시지 상태 관리</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Get Messages -->
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-3">메시지 목록 조회</h3>
                    <button id="getMessages" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 mb-4">
                        메시지 목록 가져오기
                    </button>
                    <div id="messagesResult" class="hidden"></div>
                </div>

                <!-- Update Status -->
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-3">상태 업데이트</h3>
                    <form id="statusUpdateForm">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">메시지 ID</label>
                            <input type="text" id="messageId" class="w-full px-3 py-2 border border-gray-300 rounded-md" 
                                   placeholder="msg_1234567890_abcdef">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">새 상태</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="radio" id="statusPending" name="newStatus" value="pending" class="mr-2">
                                    <label for="statusPending" class="text-sm text-gray-700">대기중 (pending)</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="statusClassified" name="newStatus" value="classified" class="mr-2">
                                    <label for="statusClassified" class="text-sm text-gray-700">분류완료 (classified)</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="statusAssigned" name="newStatus" value="assigned" class="mr-2">
                                    <label for="statusAssigned" class="text-sm text-gray-700">할당됨 (assigned)</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="statusProcessed" name="newStatus" value="processed" class="mr-2">
                                    <label for="statusProcessed" class="text-sm text-gray-700">처리완료 (processed)</label>
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700">
                            상태 업데이트
                        </button>
                    </form>
                    <div id="statusUpdateResult" class="mt-4 hidden"></div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="mt-8 bg-white shadow rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">🔍 시스템 상태</h2>
            <button id="healthCheck" class="bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700">
                헬스 체크
            </button>
            <div id="healthResult" class="mt-4 hidden"></div>
        </div>
    </div>

    <script>
        // Helper function to display results
        function displayResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.className = `mt-4 p-4 rounded-md ${isError ? 'bg-red-50 border border-red-200' : 'bg-green-50 border border-green-200'}`;
            element.innerHTML = `<pre class="text-sm ${isError ? 'text-red-800' : 'text-green-800'}">${JSON.stringify(data, null, 2)}</pre>`;
            element.classList.remove('hidden');
        }

        // SMS Form
        document.getElementById('smsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const response = await fetch('/api/intake/sms', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        from: document.getElementById('smsFrom').value,
                        body: document.getElementById('smsBody').value
                    })
                });
                const data = await response.json();
                displayResult('smsResult', data, !response.ok);
            } catch (error) {
                displayResult('smsResult', { error: error.message }, true);
            }
        });

        // Email Form
        document.getElementById('emailForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const response = await fetch('/api/intake/email', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        from: document.getElementById('emailFrom').value,
                        subject: document.getElementById('emailSubject').value,
                        body: document.getElementById('emailBody').value
                    })
                });
                const data = await response.json();
                displayResult('emailResult', data, !response.ok);
            } catch (error) {
                displayResult('emailResult', { error: error.message }, true);
            }
        });

        // Web Form
        document.getElementById('webForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const response = await fetch('/api/intake/web', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: document.getElementById('webName').value,
                        email: document.getElementById('webEmail').value,
                        message: document.getElementById('webMessage').value
                    })
                });
                const data = await response.json();
                displayResult('webResult', data, !response.ok);
            } catch (error) {
                displayResult('webResult', { error: error.message }, true);
            }
        });

        // Call Form
        document.getElementById('callForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const response = await fetch('/api/intake/call', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        caller: document.getElementById('callCaller').value,
                        duration: parseInt(document.getElementById('callDuration').value),
                        transcript: document.getElementById('callTranscript').value
                    })
                });
                const data = await response.json();
                displayResult('callResult', data, !response.ok);
            } catch (error) {
                displayResult('callResult', { error: error.message }, true);
            }
        });

        // Get Messages
        document.getElementById('getMessages').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/intake/messages');
                const data = await response.json();
                displayResult('messagesResult', data, !response.ok);
            } catch (error) {
                displayResult('messagesResult', { error: error.message }, true);
            }
        });

        // Status Update Form
        document.getElementById('statusUpdateForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                const messageId = document.getElementById('messageId').value;
                const newStatus = document.querySelector('input[name="newStatus"]:checked')?.value;

                if (!messageId || !newStatus) {
                    displayResult('statusUpdateResult', { error: '메시지 ID와 상태를 모두 선택해주세요.' }, true);
                    return;
                }

                const response = await fetch(`/api/intake/messages/${messageId}/status`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ status: newStatus })
                });
                const data = await response.json();
                displayResult('statusUpdateResult', data, !response.ok);
            } catch (error) {
                displayResult('statusUpdateResult', { error: error.message }, true);
            }
        });

        // Health Check
        document.getElementById('healthCheck').addEventListener('click', async () => {
            try {
                const response = await fetch('/health');
                const data = await response.json();
                displayResult('healthResult', data, !response.ok);
            } catch (error) {
                displayResult('healthResult', { error: error.message }, true);
            }
        });
    </script>
</body>
</html>