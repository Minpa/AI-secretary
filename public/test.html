<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Secretary - ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¤–</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="gradient-bg shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="/" class="text-white text-xl font-bold">AI Secretary</a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-white hover:text-gray-200 px-3 py-2 rounded-md">í™ˆ</a>
                    <a href="/dashboard.html" class="text-white hover:text-gray-200 px-3 py-2 rounded-md">ëŒ€ì‹œë³´ë“œ</a>
                    <a href="/reports.html" class="text-white hover:text-gray-200 px-3 py-2 rounded-md">ë¦¬í¬íŠ¸</a>
                    <a href="/workload.html" class="text-white hover:text-gray-200 px-3 py-2 rounded-md">ì¸ë ¥ ê´€ë¦¬</a>
                    <a href="/test.html" class="text-white bg-blue-700 px-3 py-2 rounded-md">í…ŒìŠ¤íŠ¸</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900">ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>
            <p class="mt-2 text-gray-600">AI Secretaryì˜ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- SMS Test -->
            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">ğŸ“± SMS ì ‘ìˆ˜ í…ŒìŠ¤íŠ¸</h2>
                <form id="smsForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ë°œì‹ ë²ˆí˜¸</label>
                        <input type="text" id="smsFrom" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="010-1234-5678" value="010-1234-5678">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ë©”ì‹œì§€ ë‚´ìš©</label>
                        <textarea id="smsBody" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="ì—˜ë¦¬ë² ì´í„°ê°€ ê³ ì¥ë‚¬ì–´ìš”">ì—˜ë¦¬ë² ì´í„°ê°€ ê³ ì¥ë‚¬ì–´ìš”</textarea>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700">
                        SMS ì „ì†¡ í…ŒìŠ¤íŠ¸
                    </button>
                </form>
                <div id="smsResult" class="mt-4 hidden"></div>

                <!-- SMS AI Conversation Simulator -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900 mb-3">ğŸ’¬ SMS AI ëŒ€í™” ì‹œë®¬ë ˆì´í„°</h3>
                    <p class="text-sm text-gray-600 mb-4">SMSë¡œ AIê°€ ì–´ë–»ê²Œ ìƒì„¸ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”</p>

                    <!-- SMS Conversation History -->
                    <div id="smsConversationHistory"
                        class="bg-gray-50 border rounded-lg p-4 mb-4 max-h-80 overflow-y-auto">
                        <div class="text-sm text-gray-500 text-center">SMS ëŒ€í™” ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
                    </div>

                    <!-- SMS Quick Start Buttons -->
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <button type="button" id="startSMSNoise"
                            class="bg-blue-500 text-white px-3 py-2 rounded text-sm hover:bg-blue-600">
                            ğŸ”‡ SMS ì†ŒìŒ ë¯¼ì›
                        </button>
                        <button type="button" id="startSMSFacility"
                            class="bg-green-500 text-white px-3 py-2 rounded text-sm hover:bg-green-600">
                            ğŸ”§ SMS ì‹œì„¤ ê³ ì¥
                        </button>
                        <button type="button" id="startSMSParking"
                            class="bg-purple-500 text-white px-3 py-2 rounded text-sm hover:bg-purple-600">
                            ğŸš— SMS ì£¼ì°¨ ë¬¸ì œ
                        </button>
                        <button type="button" id="startSMSEmergency"
                            class="bg-red-500 text-white px-3 py-2 rounded text-sm hover:bg-red-600">
                            ğŸš¨ SMS ê¸´ê¸‰ìƒí™©
                        </button>
                    </div>

                    <!-- SMS User Response Input -->
                    <form id="smsConversationForm">
                        <div class="flex gap-2">
                            <input type="text" id="smsUserResponse"
                                class="flex-1 px-3 py-2 border border-gray-300 rounded-md"
                                placeholder="SMSë¡œ AI ì§ˆë¬¸ì— ë‹µë³€í•˜ì„¸ìš”..." disabled>
                            <button type="submit" id="sendSMSResponse"
                                class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700" disabled>
                                SMS ì „ì†¡
                            </button>
                        </div>
                    </form>

                    <button type="button" id="clearSMSConversation"
                        class="mt-2 text-sm text-gray-500 hover:text-gray-700">
                        SMS ëŒ€í™” ê¸°ë¡ ì§€ìš°ê¸°
                    </button>
                </div>
            </div>

            <!-- Email Test -->
            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">ğŸ“§ ì´ë©”ì¼ ì ‘ìˆ˜ í…ŒìŠ¤íŠ¸</h2>
                <form id="emailForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ë°œì‹ ì</label>
                        <input type="email" id="emailFrom" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="resident@example.com" value="resident@example.com">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì œëª©</label>
                        <input type="text" id="emailSubject" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="ì†ŒìŒ ë¯¼ì›" value="ì†ŒìŒ ë¯¼ì›">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ë‚´ìš©</label>
                        <textarea id="emailBody" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="ìœ—ì§‘ ì†ŒìŒì´ ì‹¬í•©ë‹ˆë‹¤">ìœ—ì§‘ ì†ŒìŒì´ ì‹¬í•©ë‹ˆë‹¤</textarea>
                    </div>
                    <button type="submit"
                        class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700">
                        ì´ë©”ì¼ ì „ì†¡ í…ŒìŠ¤íŠ¸
                    </button>
                </form>
                <div id="emailResult" class="mt-4 hidden"></div>
            </div>

            <!-- Web Form Test -->
            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">ğŸŒ ì›¹í¼ ì ‘ìˆ˜ í…ŒìŠ¤íŠ¸</h2>
                <form id="webForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë¦„</label>
                        <input type="text" id="webName" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="í™ê¸¸ë™" value="í™ê¸¸ë™">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë©”ì¼</label>
                        <input type="email" id="webEmail" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="hong@example.com" value="hong@example.com">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ë¬¸ì˜ ë‚´ìš©</label>
                        <textarea id="webMessage" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="ì£¼ì°¨ì¥ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤">ì£¼ì°¨ì¥ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤</textarea>
                    </div>
                    <button type="submit"
                        class="w-full bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700">
                        ì›¹í¼ ì œì¶œ í…ŒìŠ¤íŠ¸
                    </button>
                </form>
                <div id="webResult" class="mt-4 hidden"></div>
            </div>

            <!-- Call Test -->
            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">ğŸ“ í†µí™” ê¸°ë¡ í…ŒìŠ¤íŠ¸</h2>
                <form id="callForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ë°œì‹ ë²ˆí˜¸</label>
                        <input type="text" id="callCaller" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="010-9876-5432" value="010-9876-5432">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">í†µí™” ì‹œê°„ (ë¶„)</label>
                        <input type="number" id="callDuration"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="10" value="10">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">í†µí™” ë‚´ìš© (ìŒì„±ì¸ì‹)</label>
                        <div class="flex gap-2 mb-2">
                            <button type="button" id="startRecording"
                                class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                ğŸ¤ ìŒì„± ë…¹ìŒ ì‹œì‘
                            </button>
                            <button type="button" id="stopRecording"
                                class="bg-gray-600 text-white px-3 py-1 rounded text-sm hover:bg-gray-700" disabled>
                                â¹ï¸ ë…¹ìŒ ì¤‘ì§€
                            </button>
                            <span id="recordingStatus" class="text-sm text-gray-500 self-center"></span>
                        </div>
                        <textarea id="callTranscript" rows="3"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="ê´€ë¦¬ë¹„ ë¬¸ì˜ë“œë¦½ë‹ˆë‹¤ (ë˜ëŠ” ìœ„ ë²„íŠ¼ìœ¼ë¡œ ìŒì„± ë…¹ìŒ)">ê´€ë¦¬ë¹„ ë¬¸ì˜ë“œë¦½ë‹ˆë‹¤</textarea>
                    </div>
                    <button type="submit" class="w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700">
                        í†µí™” ê¸°ë¡ í…ŒìŠ¤íŠ¸
                    </button>
                </form>
                <div id="callResult" class="mt-4 hidden"></div>
            </div>

            <!-- KakaoTalk Test -->
            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ ì ‘ìˆ˜ í…ŒìŠ¤íŠ¸</h2>
                <form id="kakaoForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì‚¬ìš©ì í‚¤</label>
                        <input type="text" id="kakaoUserKey" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="user_12345" value="user_12345">
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ë©”ì‹œì§€ íƒ€ì…</label>
                        <select id="kakaoType" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            <option value="text">í…ìŠ¤íŠ¸</option>
                            <option value="photo">ì‚¬ì§„</option>
                            <option value="video">ë™ì˜ìƒ</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ë©”ì‹œì§€ ë‚´ìš©</label>
                        <div class="mb-2">
                            <button type="button" id="kakaoSampleBtn" class="text-sm bg-gray-200 px-2 py-1 rounded">
                                ìƒ˜í”Œ ë©”ì‹œì§€ ì‚¬ìš©
                            </button>
                        </div>
                        <textarea id="kakaoContent" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                            placeholder="102ë™ 1205í˜¸ í™”ì¥ì‹¤ ë³€ê¸°ê°€ ë§‰í˜”ì–´ìš”">102ë™ 1205í˜¸ í™”ì¥ì‹¤ ë³€ê¸°ê°€ ë§‰í˜”ì–´ìš”</textarea>
                    </div>
                    <button type="submit"
                        class="w-full bg-yellow-500 text-white py-2 px-4 rounded-md hover:bg-yellow-600">
                        ì¹´ì¹´ì˜¤í†¡ ë©”ì‹œì§€ í…ŒìŠ¤íŠ¸
                    </button>
                </form>
                <div id="kakaoResult" class="mt-4 hidden"></div>

                <!-- KakaoTalk AI Conversation Simulator -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900 mb-3">ğŸ’¬ ì¹´ì¹´ì˜¤í†¡ AI ëŒ€í™” ì‹œë®¬ë ˆì´í„°</h3>
                    <p class="text-sm text-gray-600 mb-4">ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ AIê°€ ì–´ë–»ê²Œ ìƒì„¸ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”</p>

                    <!-- KakaoTalk Conversation History -->
                    <div id="kakaoConversationHistory"
                        class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4 max-h-80 overflow-y-auto">
                        <div class="text-sm text-gray-500 text-center">ì¹´ì¹´ì˜¤í†¡ ëŒ€í™” ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
                    </div>

                    <!-- KakaoTalk Quick Start Buttons -->
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <button type="button" id="startKakaoNoise"
                            class="bg-yellow-500 text-white px-3 py-2 rounded text-sm hover:bg-yellow-600">
                            ğŸ”‡ ì¹´í†¡ ì†ŒìŒ ë¯¼ì›
                        </button>
                        <button type="button" id="startKakaoFacility"
                            class="bg-yellow-600 text-white px-3 py-2 rounded text-sm hover:bg-yellow-700">
                            ğŸ”§ ì¹´í†¡ ì‹œì„¤ ê³ ì¥
                        </button>
                        <button type="button" id="startKakaoParking"
                            class="bg-yellow-400 text-white px-3 py-2 rounded text-sm hover:bg-yellow-500">
                            ğŸš— ì¹´í†¡ ì£¼ì°¨ ë¬¸ì œ
                        </button>
                        <button type="button" id="startKakaoEmergency"
                            class="bg-red-500 text-white px-3 py-2 rounded text-sm hover:bg-red-600">
                            ğŸš¨ ì¹´í†¡ ê¸´ê¸‰ìƒí™©
                        </button>
                    </div>

                    <!-- KakaoTalk User Response Input -->
                    <form id="kakaoConversationForm">
                        <div class="flex gap-2">
                            <input type="text" id="kakaoUserResponse"
                                class="flex-1 px-3 py-2 border border-yellow-300 rounded-md"
                                placeholder="ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ AI ì§ˆë¬¸ì— ë‹µë³€í•˜ì„¸ìš”..." disabled>
                            <button type="submit" id="sendKakaoResponse"
                                class="bg-yellow-500 text-white px-4 py-2 rounded-md hover:bg-yellow-600" disabled>
                                ì¹´í†¡ ì „ì†¡
                            </button>
                        </div>
                    </form>

                    <button type="button" id="clearKakaoConversation"
                        class="mt-2 text-sm text-gray-500 hover:text-gray-700">
                        ì¹´ì¹´ì˜¤í†¡ ëŒ€í™” ê¸°ë¡ ì§€ìš°ê¸°
                    </button>
                </div>

                <!-- AI Conversation Simulator -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900 mb-3">ğŸ¤– AI ëŒ€í™” ì‹œë®¬ë ˆì´í„°</h3>
                    <p class="text-sm text-gray-600 mb-4">AIê°€ ì–´ë–»ê²Œ ìƒì„¸ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì„¸ìš”</p>

                    <!-- Conversation History -->
                    <div id="conversationHistory"
                        class="bg-gray-50 border rounded-lg p-4 mb-4 max-h-96 overflow-y-auto">
                        <div class="text-sm text-gray-500 text-center">ëŒ€í™” ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
                    </div>

                    <!-- Quick Start Buttons -->
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <button type="button" id="startNoiseConversation"
                            class="bg-blue-500 text-white px-3 py-2 rounded text-sm hover:bg-blue-600">
                            ğŸ”‡ ì†ŒìŒ ë¯¼ì› ì‹œì‘
                        </button>
                        <button type="button" id="startFacilityConversation"
                            class="bg-green-500 text-white px-3 py-2 rounded text-sm hover:bg-green-600">
                            ğŸ”§ ì‹œì„¤ ê³ ì¥ ì‹œì‘
                        </button>
                        <button type="button" id="startParkingConversation"
                            class="bg-purple-500 text-white px-3 py-2 rounded text-sm hover:bg-purple-600">
                            ğŸš— ì£¼ì°¨ ë¬¸ì œ ì‹œì‘
                        </button>
                        <button type="button" id="startEmergencyConversation"
                            class="bg-red-500 text-white px-3 py-2 rounded text-sm hover:bg-red-600">
                            ğŸš¨ ê¸´ê¸‰ìƒí™© ì‹œì‘
                        </button>
                    </div>

                    <!-- User Response Input -->
                    <form id="conversationResponseForm">
                        <div class="flex gap-2">
                            <input type="text" id="userResponse"
                                class="flex-1 px-3 py-2 border border-gray-300 rounded-md" placeholder="AI ì§ˆë¬¸ì— ë‹µë³€í•˜ì„¸ìš”..."
                                disabled>
                            <button type="submit" id="sendResponse"
                                class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700" disabled>
                                ì „ì†¡
                            </button>
                        </div>
                    </form>

                    <button type="button" id="clearConversation" class="mt-2 text-sm text-gray-500 hover:text-gray-700">
                        ëŒ€í™” ê¸°ë¡ ì§€ìš°ê¸°
                    </button>
                </div>

                <!-- KakaoTalk Conversation Response Test -->
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900 mb-3">ğŸ’¬ ëŒ€í™” ì‘ë‹µ í…ŒìŠ¤íŠ¸ (API)</h3>
                    <form id="kakaoResponseForm">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">ë©”ì‹œì§€ ID</label>
                            <input type="text" id="kakaoResponseMessageId"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md"
                                placeholder="msg_1234567890_abcdef">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">ì‚¬ìš©ì ì‘ë‹µ</label>
                            <textarea id="kakaoResponseContent" rows="2"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md"
                                placeholder="ì—˜ë¦¬ë² ì´í„°">ì—˜ë¦¬ë² ì´í„°</textarea>
                        </div>
                        <button type="submit"
                            class="w-full bg-yellow-400 text-white py-2 px-4 rounded-md hover:bg-yellow-500">
                            ëŒ€í™” ì‘ë‹µ í…ŒìŠ¤íŠ¸
                        </button>
                    </form>
                    <div id="kakaoResponseResult" class="mt-4 hidden"></div>
                </div>
            </div>
        </div>

        <!-- LLM Management Section -->
        <div class="mt-8 bg-white shadow rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">ğŸ¤– LLM ê´€ë¦¬</h2>
            <p class="text-sm text-gray-600 mb-6">ë¡œì»¬ Mistral-7B ëª¨ë¸ ì œì–´ ë° í…ŒìŠ¤íŠ¸</p>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- LLM Status & Control -->
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-3">ìƒíƒœ ë° ì œì–´</h3>

                    <!-- Status Display -->
                    <div id="llmStatus" class="p-4 bg-gray-50 rounded-md mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-medium">ìƒíƒœ:</span>
                            <span id="llmStatusText" class="text-gray-600">í™•ì¸ ì¤‘...</span>
                        </div>
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-medium">ëª¨ë¸:</span>
                            <span id="llmModel" class="text-gray-600">-</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="font-medium">ì‚¬ìš© ê°€ëŠ¥:</span>
                            <span id="llmAvailable" class="text-gray-600">-</span>
                        </div>
                    </div>

                    <!-- LLM Toggle -->
                    <div class="flex items-center justify-between p-4 bg-blue-50 rounded-md mb-4">
                        <div>
                            <h4 class="font-medium text-blue-900">LLM ë¶„ë¥˜ ì‚¬ìš©</h4>
                            <p class="text-sm text-blue-700">ì‹ ë¢°ë„ ë‚®ì„ ë•Œ LLM ì‚¬ìš©</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="llmToggle" class="sr-only peer">
                            <div
                                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                            </div>
                        </label>
                    </div>

                    <button id="refreshLLMStatus"
                        class="w-full bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700 mb-2">
                        ğŸ”„ ìƒíƒœ ìƒˆë¡œê³ ì¹¨
                    </button>

                    <button id="checkCurrentStatus"
                        class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 mb-2">
                        ğŸ” í˜„ì¬ ìƒíƒœ í™•ì¸
                    </button>

                    <button id="manualLoadStatus"
                        class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700">
                        ğŸ”§ ìˆ˜ë™ ìƒíƒœ ë¡œë“œ
                    </button>
                </div>

                <!-- LLM Test -->
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-3">LLM ë¶„ë¥˜ í…ŒìŠ¤íŠ¸</h3>
                    <textarea id="llmTestText" rows="4"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"
                        placeholder="ë¶„ë¥˜í•  ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">101ë™ 1502í˜¸ì—ì„œ ìœ—ì§‘ ì†ŒìŒ ë•Œë¬¸ì— ê³ ìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. ë°¤ëŠ¦ê²Œê¹Œì§€ ì¿µì¿µê±°ë¦¬ëŠ” ì†Œë¦¬ê°€ ë‚˜ì„œ ì ì„ ì˜ ìˆ˜ê°€ ì—†ì–´ìš”.</textarea>

                    <button id="testLLM"
                        class="w-full bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700 mb-2">
                        ğŸ¤– LLM ë¶„ë¥˜ í…ŒìŠ¤íŠ¸
                    </button>

                    <button id="testLLMKeywords"
                        class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 mb-2">
                        ğŸ” LLM í‚¤ì›Œë“œ ë¶„ì„
                    </button>

                    <button id="testApartmentParsing"
                        class="w-full bg-orange-600 text-white py-2 px-4 rounded-md hover:bg-orange-700 mb-4">
                        ğŸ¢ ì•„íŒŒíŠ¸ ë™/í˜¸ìˆ˜ ë¶„ì„
                    </button>

                    <div id="llmTestResult" class="hidden"></div>
                    <div id="llmKeywordsResult" class="hidden"></div>
                    <div id="apartmentParsingResult" class="hidden"></div>
                </div>
            </div>
        </div>

        <!-- Message Status Management -->
        <div class="mt-8 bg-white shadow rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">ğŸ“‹ ë©”ì‹œì§€ ìƒíƒœ ê´€ë¦¬</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Get Messages -->
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-3">ë©”ì‹œì§€ ëª©ë¡ ì¡°íšŒ</h3>
                    <button id="getMessages"
                        class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 mb-4">
                        ë©”ì‹œì§€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
                    </button>
                    <div id="messagesResult" class="hidden"></div>
                </div>

                <!-- Update Status -->
                <div>
                    <h3 class="text-lg font-medium text-gray-900 mb-3">ìƒíƒœ ì—…ë°ì´íŠ¸</h3>
                    <form id="statusUpdateForm">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">ë©”ì‹œì§€ ID</label>
                            <input type="text" id="messageId" class="w-full px-3 py-2 border border-gray-300 rounded-md"
                                placeholder="msg_1234567890_abcdef">
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">ìƒˆ ìƒíƒœ</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="radio" id="statusPending" name="newStatus" value="pending"
                                        class="mr-2">
                                    <label for="statusPending" class="text-sm text-gray-700">ëŒ€ê¸°ì¤‘ (pending)</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="statusClassified" name="newStatus" value="classified"
                                        class="mr-2">
                                    <label for="statusClassified" class="text-sm text-gray-700">ë¶„ë¥˜ì™„ë£Œ
                                        (classified)</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="statusAssigned" name="newStatus" value="assigned"
                                        class="mr-2">
                                    <label for="statusAssigned" class="text-sm text-gray-700">í• ë‹¹ë¨ (assigned)</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="radio" id="statusProcessed" name="newStatus" value="processed"
                                        class="mr-2">
                                    <label for="statusProcessed" class="text-sm text-gray-700">ì²˜ë¦¬ì™„ë£Œ (processed)</label>
                                </div>
                            </div>
                        </div>
                        <button type="submit"
                            class="w-full bg-purple-600 text-white py-2 px-4 rounded-md hover:bg-purple-700">
                            ìƒíƒœ ì—…ë°ì´íŠ¸
                        </button>
                    </form>
                    <div id="statusUpdateResult" class="mt-4 hidden"></div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="mt-8 bg-white shadow rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">ğŸ” ì‹œìŠ¤í…œ ìƒíƒœ</h2>
            <button id="healthCheck" class="bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700">
                í—¬ìŠ¤ ì²´í¬
            </button>
            <div id="healthResult" class="mt-4 hidden"></div>
        </div>
    </div>

    <script>
        // Helper function to display results
        function displayResult(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.className = `mt-4 p-4 rounded-md ${isError ? 'bg-red-50 border border-red-200' : 'bg-green-50 border border-green-200'}`;
            element.innerHTML = `<pre class="text-sm ${isError ? 'text-red-800' : 'text-green-800'}">${JSON.stringify(data, null, 2)}</pre>`;
            element.classList.remove('hidden');
        }

        // SMS Form
        document.getElementById('smsForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/intake/sms', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        displayResult('smsResult', data, xhr.status !== 200);
                    } catch (parseError) {
                        displayResult('smsResult', { error: 'Parse error: ' + parseError.message }, true);
                    }
                }
            };

            xhr.onerror = function () {
                displayResult('smsResult', { error: 'Network error' }, true);
            };

            xhr.send(JSON.stringify({
                from: document.getElementById('smsFrom').value,
                body: document.getElementById('smsBody').value
            }));
        });

        // Email Form
        document.getElementById('emailForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/intake/email', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        displayResult('emailResult', data, xhr.status !== 200);
                    } catch (parseError) {
                        displayResult('emailResult', { error: 'Parse error: ' + parseError.message }, true);
                    }
                }
            };

            xhr.onerror = function () {
                displayResult('emailResult', { error: 'Network error' }, true);
            };

            xhr.send(JSON.stringify({
                from: document.getElementById('emailFrom').value,
                subject: document.getElementById('emailSubject').value,
                body: document.getElementById('emailBody').value
            }));
        });

        // Web Form
        document.getElementById('webForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/intake/web', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        displayResult('webResult', data, xhr.status !== 200);
                    } catch (parseError) {
                        displayResult('webResult', { error: 'Parse error: ' + parseError.message }, true);
                    }
                }
            };

            xhr.onerror = function () {
                displayResult('webResult', { error: 'Network error' }, true);
            };

            xhr.send(JSON.stringify({
                name: document.getElementById('webName').value,
                email: document.getElementById('webEmail').value,
                message: document.getElementById('webMessage').value
            }));
        });

        // Call Form
        document.getElementById('callForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/intake/call', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        displayResult('callResult', data, xhr.status !== 200);
                    } catch (parseError) {
                        displayResult('callResult', { error: 'Parse error: ' + parseError.message }, true);
                    }
                }
            };

            xhr.onerror = function () {
                displayResult('callResult', { error: 'Network error' }, true);
            };

            xhr.send(JSON.stringify({
                caller: document.getElementById('callCaller').value,
                duration: parseInt(document.getElementById('callDuration').value),
                transcript: document.getElementById('callTranscript').value
            }));
        });

        // KakaoTalk Form
        document.getElementById('kakaoForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/intake/kakaotalk', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        displayResult('kakaoResult', data, xhr.status !== 200);

                        // Auto-fill message ID for conversation response test
                        if (data.success && data.data && data.data.id) {
                            document.getElementById('kakaoResponseMessageId').value = data.data.id;
                        }
                    } catch (parseError) {
                        displayResult('kakaoResult', { error: 'Parse error: ' + parseError.message }, true);
                    }
                }
            };

            xhr.onerror = function () {
                displayResult('kakaoResult', { error: 'Network error' }, true);
            };

            xhr.send(JSON.stringify({
                user_key: document.getElementById('kakaoUserKey').value,
                content: document.getElementById('kakaoContent').value,
                type: document.getElementById('kakaoType').value
            }));
        });

        // KakaoTalk Sample Messages
        document.getElementById('kakaoSampleBtn').addEventListener('click', function () {
            const samples = [
                "102ë™ 1205í˜¸ ì—˜ë¦¬ë² ì´í„°ê°€ ê³ ì¥ë‚¬ì–´ìš”",
                "ìœ—ì§‘ ì†ŒìŒì´ ë„ˆë¬´ ì‹¬í•´ì„œ ì ì„ ëª»ìê² ì–´ìš”",
                "ì§€í•˜ì£¼ì°¨ì¥ì— ë¶ˆë²•ì£¼ì°¨ ì°¨ëŸ‰ì´ ìˆìŠµë‹ˆë‹¤",
                "ê´€ë¦¬ë¹„ê°€ ì´ìƒí•˜ê²Œ ë‚˜ì™”ëŠ”ë° í™•ì¸í•´ì£¼ì„¸ìš”",
                "ì •ì „ì´ ëëŠ”ë° ì–¸ì œ ë³µêµ¬ë˜ë‚˜ìš”?",
                "ì“°ë ˆê¸°ì¥ì—ì„œ ì•…ì·¨ê°€ ì‹¬í•˜ê²Œ ë‚©ë‹ˆë‹¤",
                "íƒë°°ê°€ ë¶„ì‹¤ëœ ê²ƒ ê°™ì•„ìš”"
            ];
            const randomSample = samples[Math.floor(Math.random() * samples.length)];
            document.getElementById('kakaoContent').value = randomSample;
        });

        // KakaoTalk Response Form
        document.getElementById('kakaoResponseForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/intake/kakaotalk/response', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        displayResult('kakaoResponseResult', data, xhr.status !== 200);
                    } catch (parseError) {
                        displayResult('kakaoResponseResult', { error: 'Parse error: ' + parseError.message }, true);
                    }
                }
            };

            xhr.onerror = function () {
                displayResult('kakaoResponseResult', { error: 'Network error' }, true);
            };

            xhr.send(JSON.stringify({
                user_key: document.getElementById('kakaoUserKey').value,
                content: document.getElementById('kakaoResponseContent').value,
                messageId: document.getElementById('kakaoResponseMessageId').value
            }));
        });

        // Get Messages
        document.getElementById('getMessages').addEventListener('click', function () {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', '/api/intake/messages', true);
            xhr.setRequestHeader('Accept', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        displayResult('messagesResult', data, xhr.status !== 200);
                    } catch (parseError) {
                        displayResult('messagesResult', { error: 'Parse error: ' + parseError.message }, true);
                    }
                }
            };

            xhr.onerror = function () {
                displayResult('messagesResult', { error: 'Network error' }, true);
            };

            xhr.send();
        });

        // Status Update Form
        document.getElementById('statusUpdateForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const messageId = document.getElementById('messageId').value;
            const newStatusEl = document.querySelector('input[name="newStatus"]:checked');
            const newStatus = newStatusEl ? newStatusEl.value : null;

            if (!messageId || !newStatus) {
                displayResult('statusUpdateResult', { error: 'ë©”ì‹œì§€ IDì™€ ìƒíƒœë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.' }, true);
                return;
            }

            const xhr = new XMLHttpRequest();
            xhr.open('PATCH', '/api/intake/messages/' + messageId + '/status', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        displayResult('statusUpdateResult', data, xhr.status !== 200);
                    } catch (parseError) {
                        displayResult('statusUpdateResult', { error: 'Parse error: ' + parseError.message }, true);
                    }
                }
            };

            xhr.onerror = function () {
                displayResult('statusUpdateResult', { error: 'Network error' }, true);
            };

            xhr.send(JSON.stringify({ status: newStatus }));
        });

        // Health Check
        document.getElementById('healthCheck').addEventListener('click', function () {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', '/health', true);
            xhr.setRequestHeader('Accept', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        displayResult('healthResult', data, xhr.status !== 200);
                    } catch (parseError) {
                        displayResult('healthResult', { error: 'Parse error: ' + parseError.message }, true);
                    }
                }
            };

            xhr.onerror = function () {
                displayResult('healthResult', { error: 'Network error' }, true);
            };

            xhr.send();
        });

        // LLM Management Functions
        function loadLLMStatus() {
            console.log('ğŸ”„ Loading LLM status...');

            // Check if elements exist first
            const statusTextEl = document.getElementById('llmStatusText');
            const modelEl = document.getElementById('llmModel');
            const availableEl = document.getElementById('llmAvailable');
            const toggleEl = document.getElementById('llmToggle');

            console.log('ğŸ” DOM elements check:', {
                statusTextEl: !!statusTextEl,
                modelEl: !!modelEl,
                availableEl: !!availableEl,
                toggleEl: !!toggleEl
            });

            if (!statusTextEl) {
                console.error('âŒ llmStatusText element not found!');
                return;
            }

            // Use XMLHttpRequest for better compatibility
            const xhr = new XMLHttpRequest();
            xhr.open('GET', '/api/intake/llm/status', true);
            xhr.setRequestHeader('Accept', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        try {
                            const data = JSON.parse(xhr.responseText);
                            console.log('ğŸ“Š LLM status response:', data);

                            if (data.success) {
                                const status = data.data;
                                console.log('âœ… LLM status data:', status);

                                statusTextEl.textContent = status.enabled ? 'í™œì„±í™”ë¨' : 'ë¹„í™œì„±í™”ë¨';
                                if (modelEl) modelEl.textContent = status.config.model || '-';
                                if (availableEl) availableEl.textContent = status.available ? 'âœ… ì‚¬ìš© ê°€ëŠ¥' : 'âŒ ì‚¬ìš© ë¶ˆê°€';
                                if (toggleEl) toggleEl.checked = status.enabled;

                                // Update status color
                                statusTextEl.className = status.enabled && status.available ? 'text-green-600 font-medium' : 'text-red-600 font-medium';

                                console.log('âœ… LLM status UI updated successfully');
                            } else {
                                console.error('âŒ LLM status API failed:', data);
                                statusTextEl.textContent = 'ì˜¤ë¥˜';
                                statusTextEl.className = 'text-red-600 font-medium';
                            }
                        } catch (parseError) {
                            console.error('âŒ Parse error:', parseError);
                            statusTextEl.textContent = 'íŒŒì‹± ì˜¤ë¥˜';
                            statusTextEl.className = 'text-red-600 font-medium';
                        }
                    } else {
                        console.error('âŒ HTTP error:', xhr.status);
                        statusTextEl.textContent = 'HTTP ì˜¤ë¥˜: ' + xhr.status;
                        statusTextEl.className = 'text-red-600 font-medium';
                    }
                }
            };

            xhr.onerror = function () {
                console.error('âŒ Network error');
                statusTextEl.textContent = 'ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜';
                statusTextEl.className = 'text-red-600 font-medium';
            };

            xhr.send();
        }

        // LLM Toggle
        document.getElementById('llmToggle').addEventListener('change', function (e) {
            const enabled = e.target.checked;

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/intake/llm/toggle', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    if (xhr.status === 200) {
                        try {
                            const data = JSON.parse(xhr.responseText);
                            if (data.success) {
                                loadLLMStatus(); // Refresh status
                                alert(`LLM ì„œë¹„ìŠ¤ê°€ ${enabled ? 'í™œì„±í™”' : 'ë¹„í™œì„±í™”'}ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                            } else {
                                e.target.checked = !enabled; // Revert toggle
                                alert('LLM ì„¤ì • ë³€ê²½ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + data.error);
                            }
                        } catch (parseError) {
                            e.target.checked = !enabled; // Revert toggle
                            alert('ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜: ' + parseError.message);
                        }
                    } else {
                        e.target.checked = !enabled; // Revert toggle
                        alert('HTTP ì˜¤ë¥˜: ' + xhr.status);
                    }
                }
            };

            xhr.onerror = function () {
                e.target.checked = !enabled; // Revert toggle
                alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            };

            xhr.send(JSON.stringify({ enabled: enabled }));
        });

        // LLM Test
        document.getElementById('testLLM').addEventListener('click', function () {
            const text = document.getElementById('llmTestText').value.trim();

            if (!text) {
                alert('í…ŒìŠ¤íŠ¸í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/intake/llm/test', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        displayResult('llmTestResult', data, xhr.status !== 200);
                    } catch (parseError) {
                        displayResult('llmTestResult', { error: 'Parse error: ' + parseError.message }, true);
                    }
                }
            };

            xhr.onerror = function () {
                displayResult('llmTestResult', { error: 'Network error' }, true);
            };

            xhr.send(JSON.stringify({ text: text }));
        });

        // Refresh LLM Status
        document.getElementById('refreshLLMStatus').addEventListener('click', loadLLMStatus);

        // Check Current Status
        document.getElementById('checkCurrentStatus').addEventListener('click', function () {
            const statusText = document.getElementById('llmStatusText').textContent;
            alert('LLM Status: ' + statusText);
        });

        // Manual Load Status
        document.getElementById('manualLoadStatus').addEventListener('click', function () {
            loadLLMStatus();
            alert('LLM ìƒíƒœ ë¡œë“œ í•¨ìˆ˜ë¥¼ ìˆ˜ë™ìœ¼ë¡œ í˜¸ì¶œí–ˆìŠµë‹ˆë‹¤.');
        });

        // Load LLM status on page load
        console.log('ğŸš€ Page loaded, loading LLM status...');
        console.log('ğŸ” Testing if script is running...');

        // Test if DOM elements are accessible
        setTimeout(() => {
            const testEl = document.getElementById('llmStatusText');
            console.log('ğŸ§ª Test element found:', !!testEl);
            if (testEl) {
                console.log('ğŸ§ª Test element content:', testEl.textContent);
                // Force update the text to see if DOM manipulation works
                testEl.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
                testEl.style.color = 'blue';
            }
        }, 100);

        loadLLMStatus();

        // Also load status after a short delay in case of timing issues
        setTimeout(() => {
            console.log('ğŸ”„ Delayed LLM status load...');
            loadLLMStatus();
        }, 1000);

        // Test Apartment Parsing
        document.getElementById('testApartmentParsing').addEventListener('click', function () {
            const text = document.getElementById('llmTestText').value.trim();

            if (!text) {
                alert('í…ŒìŠ¤íŠ¸í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '/api/intake/llm/apartment', true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        displayResult('apartmentParsingResult', data, xhr.status !== 200);
                    } catch (parseError) {
                        displayResult('apartmentParsingResult', { error: 'Parse error: ' + parseError.message }, true);
                    }
                }
            };

            xhr.onerror = function () {
                displayResult('apartmentParsingResult', { error: 'Network error' }, true);
            };

            xhr.send(JSON.stringify({ text: text }));
        });
        // Simplified LLM Analysis (removed complex async function that was causing syntax errors)
        if (document.getElementById('enableLLMAnalysis')) {
            document.getElementById('enableLLMAnalysis').addEventListener('click', function () {
                alert('LLM ë¶„ì„ ê¸°ëŠ¥ì€ í˜„ì¬ ë‹¨ìˆœí™”ë˜ì—ˆìŠµë‹ˆë‹¤. ê°œë³„ LLM í…ŒìŠ¤íŠ¸ ë²„íŠ¼ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
            });
        }

        // Test LLM Keywords
        document.getElementById('testLLMKeywords').addEventListener('click', function () {
            console.log('ğŸ” Starting LLM keywords analysis...');

            // Show loading message
            displayResult('llmKeywordsResult', { message: 'í‚¤ì›Œë“œ ë¶„ì„ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.' }, false);

            // First get sample messages
            const xhr1 = new XMLHttpRequest();
            xhr1.open('GET', '/api/intake/messages?limit=50', true);
            xhr1.setRequestHeader('Accept', 'application/json');

            xhr1.onreadystatechange = function () {
                if (xhr1.readyState === 4) {
                    console.log('ğŸ“¡ Messages API response:', xhr1.status);
                    if (xhr1.status === 200) {
                        try {
                            const data = JSON.parse(xhr1.responseText);
                            console.log('ğŸ“Š Messages data:', data);

                            if (!data.success) {
                                displayResult('llmKeywordsResult', { error: 'ë©”ì‹œì§€ ë¡œë“œ ì‹¤íŒ¨: ' + data.error }, true);
                                return;
                            }

                            // Extract both message content and apartment unit info
                            const messagesWithUnits = data.data.map(function (msg) {
                                const messageData = {
                                    content: msg.content || msg.maskedContent,
                                    apartmentUnit: msg.apartmentUnit
                                };
                                return messageData;
                            });

                            const messages = messagesWithUnits.map(function (msg) {
                                return msg.content;
                            });

                            console.log('ğŸ“ Extracted messages:', messages.length, 'messages');
                            console.log('ğŸ¢ Messages with apartment units:', messagesWithUnits.filter(function (msg) { return msg.apartmentUnit; }).length);

                            // Now send to LLM keywords endpoint
                            const xhr2 = new XMLHttpRequest();
                            xhr2.open('POST', '/api/intake/llm/keywords', true);
                            xhr2.setRequestHeader('Content-Type', 'application/json');

                            xhr2.onreadystatechange = function () {
                                if (xhr2.readyState === 4) {
                                    console.log('ğŸ¤– LLM Keywords API response:', xhr2.status);
                                    try {
                                        const keywordData = JSON.parse(xhr2.responseText);
                                        console.log('âœ… Keywords result:', keywordData);
                                        displayResult('llmKeywordsResult', keywordData, xhr2.status !== 200);
                                    } catch (parseError) {
                                        console.error('âŒ Parse error:', parseError);
                                        displayResult('llmKeywordsResult', { error: 'Parse error: ' + parseError.message }, true);
                                    }
                                }
                            };

                            xhr2.onerror = function () {
                                displayResult('llmKeywordsResult', { error: 'Network error' }, true);
                            };

                            const requestData = {
                                messages: messages,
                                messagesWithUnits: messagesWithUnits
                            };

                            console.log('ğŸ“¤ Sending to LLM keywords API:', requestData);
                            xhr2.send(JSON.stringify(requestData));

                        } catch (parseError) {
                            displayResult('llmKeywordsResult', { error: 'Parse error: ' + parseError.message }, true);
                        }
                    } else {
                        displayResult('llmKeywordsResult', { error: 'HTTP error: ' + xhr1.status }, true);
                    }
                }
            };

            xhr1.onerror = function () {
                displayResult('llmKeywordsResult', { error: 'Network error' }, true);
            };

            xhr1.send();
        });

        // Voice Recording for Call Testing
        let recognition = null;
        let isRecording = false;
        let recordingTimer = null;
        let recordingStartTime = null;

        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'ko-KR';
            recognition.continuous = true;  // Allow continuous recording
            recognition.interimResults = true;  // Show interim results
            recognition.maxAlternatives = 1;

            document.getElementById('startRecording').onclick = () => {
                if (!isRecording) {
                    recognition.start();
                    isRecording = true;
                    recordingStartTime = Date.now();
                    document.getElementById('startRecording').disabled = true;
                    document.getElementById('stopRecording').disabled = false;
                    document.getElementById('recordingStatus').textContent = 'ğŸ”´ ë…¹ìŒ ì¤‘... (0ì´ˆ)';

                    // Start timer to show recording duration
                    recordingTimer = setInterval(() => {
                        if (isRecording) {
                            const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
                            document.getElementById('recordingStatus').textContent = `ğŸ”´ ë…¹ìŒ ì¤‘... (${elapsed}ì´ˆ)`;

                            // Auto-stop after 15 seconds to prevent timeout
                            if (elapsed >= 15) {
                                recognition.stop();
                            }
                        }
                    }, 1000);
                }
            };

            document.getElementById('stopRecording').onclick = () => {
                if (isRecording) {
                    recognition.stop();
                }
            };

            recognition.onresult = (event) => {
                let finalTranscript = '';
                let interimTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }

                // Update textarea with final + interim results
                const currentText = document.getElementById('callTranscript').value;
                const newText = finalTranscript || interimTranscript;

                if (finalTranscript) {
                    document.getElementById('callTranscript').value = currentText + finalTranscript;
                } else if (interimTranscript) {
                    // Show interim results in placeholder or status
                    document.getElementById('recordingStatus').textContent = `ğŸ”´ ë…¹ìŒ ì¤‘... "${interimTranscript}"`;
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                document.getElementById('recordingStatus').textContent = 'âŒ ë…¹ìŒ ì˜¤ë¥˜: ' + event.error;
                resetRecordingButtons();
            };

            recognition.onend = () => {
                const elapsed = recordingStartTime ? Math.floor((Date.now() - recordingStartTime) / 1000) : 0;
                document.getElementById('recordingStatus').textContent = `âœ… ë…¹ìŒ ì™„ë£Œ (${elapsed}ì´ˆ)`;
                resetRecordingButtons();
            };

            function resetRecordingButtons() {
                isRecording = false;
                document.getElementById('startRecording').disabled = false;
                document.getElementById('stopRecording').disabled = true;

                if (recordingTimer) {
                    clearInterval(recordingTimer);
                    recordingTimer = null;
                }
            }
        } else {
            // Hide recording buttons if not supported
            document.getElementById('startRecording').style.display = 'none';
            document.getElementById('stopRecording').style.display = 'none';
            document.getElementById('recordingStatus').textContent = 'ìŒì„± ì¸ì‹ì´ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.';
        }

        // AI Conversation Simulators
        let currentConversation = null;
        let conversationStep = 0;
        let currentSMSConversation = null;
        let smsConversationStep = 0;
        let currentKakaoConversation = null;
        let kakaoConversationStep = 0;

        const conversationFlows = {
            noise: {
                title: "ì†ŒìŒ ë¯¼ì›",
                steps: [
                    {
                        question: "ì–´ë–¤ ì¢…ë¥˜ì˜ ì†ŒìŒì¸ê°€ìš”?\n1ï¸âƒ£ ì¸µê°„ì†ŒìŒ\n2ï¸âƒ£ ê¸°ê³„ì‹¤ ì†ŒìŒ\n3ï¸âƒ£ ì§‘íšŒ/íŒŒí‹° ì†Œë¦¬\n4ï¸âƒ£ ê³µì‚¬ ì†ŒìŒ\n5ï¸âƒ£ ê¸°íƒ€",
                        options: ["ì¸µê°„ì†ŒìŒ", "ê¸°ê³„ì‹¤ ì†ŒìŒ", "ì§‘íšŒ/íŒŒí‹° ì†Œë¦¬", "ê³µì‚¬ ì†ŒìŒ", "ê¸°íƒ€"]
                    },
                    {
                        question: "ì†ŒìŒ ë°œìƒ ìœ„ì¹˜ë¥¼ ì•Œë ¤ì£¼ì„¸ìš” (ì˜ˆ: ìœ—ì§‘, ì˜†ì§‘, ì•„ë˜ì¸µ)",
                        field: "location"
                    },
                    {
                        question: "ì£¼ë¡œ ì–¸ì œ ì†ŒìŒì´ ë°œìƒí•˜ë‚˜ìš”?\n1ï¸âƒ£ ìƒˆë²½ (00-06ì‹œ)\n2ï¸âƒ£ ì˜¤ì „ (06-12ì‹œ)\n3ï¸âƒ£ ì˜¤í›„ (12-18ì‹œ)\n4ï¸âƒ£ ì €ë… (18-24ì‹œ)\n5ï¸âƒ£ í•˜ë£¨ì¢…ì¼",
                        options: ["ìƒˆë²½", "ì˜¤ì „", "ì˜¤í›„", "ì €ë…", "í•˜ë£¨ì¢…ì¼"]
                    },
                    {
                        question: "ì†ŒìŒ ì •ë„ëŠ” ì–´ë–¤ê°€ìš”?\n1ï¸âƒ£ ì•½ê°„ ì‹ ê²½ì“°ì„\n2ï¸âƒ£ ìƒí™œì— ì§€ì¥\n3ï¸âƒ£ ì ì„ ëª»ì˜ ì •ë„\n4ï¸âƒ£ ë§¤ìš° ì‹¬ê°",
                        options: ["ì•½ê°„ ì‹ ê²½ì“°ì„", "ìƒí™œì— ì§€ì¥", "ì ì„ ëª»ì˜ ì •ë„", "ë§¤ìš° ì‹¬ê°"]
                    }
                ],
                completion: "ğŸ”‡ ì†ŒìŒ ë‹´ë‹¹ìê°€ í˜„ì¥ í™•ì¸ í›„ ì¡°ì¹˜í•˜ê² ìŠµë‹ˆë‹¤.\nğŸ“‹ í•„ìš”ì‹œ ì¸µê°„ì†ŒìŒ ì¸¡ì •ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\nâ° ì²˜ë¦¬ ì˜ˆìƒ ì‹œê°„: 1-2ì¼"
            },
            facility: {
                title: "ì‹œì„¤ ê³ ì¥",
                steps: [
                    {
                        question: "ì–´ë–¤ ê³µìš©ì‹œì„¤ì— ë¬¸ì œê°€ ìˆë‚˜ìš”?\n1ï¸âƒ£ ì—˜ë¦¬ë² ì´í„°\n2ï¸âƒ£ ë³µë„\n3ï¸âƒ£ ì£¼ì°¨ì¥\n4ï¸âƒ£ ê¸°íƒ€",
                        options: ["ì—˜ë¦¬ë² ì´í„°", "ë³µë„", "ì£¼ì°¨ì¥", "ê¸°íƒ€"]
                    },
                    {
                        question: "ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì•Œë ¤ì£¼ì„¸ìš” (ì˜ˆ: 101ë™ ì•, ì§€í•˜1ì¸µ ì£¼ì°¨ì¥)",
                        field: "location"
                    },
                    {
                        question: "ì–´ë–¤ ë¬¸ì œì¸ê°€ìš”?\n1ï¸âƒ£ ê³ ì¥\n2ï¸âƒ£ íŒŒì†\n3ï¸âƒ£ ì²­ì†Œ í•„ìš”\n4ï¸âƒ£ ê¸°íƒ€",
                        options: ["ê³ ì¥", "íŒŒì†", "ì²­ì†Œ í•„ìš”", "ê¸°íƒ€"]
                    },
                    {
                        question: "ì–¸ì œë¶€í„° ë¬¸ì œê°€ ìˆì—ˆë‚˜ìš”? (ì˜ˆ: ì˜¤ëŠ˜ ì•„ì¹¨ë¶€í„°, 3ì¼ ì „ë¶€í„°)",
                        field: "duration"
                    }
                ],
                completion: "ğŸ”§ ì‹œì„¤ ë‹´ë‹¹ìê°€ í™•ì¸ í›„ ìˆ˜ë¦¬ ì¼ì •ì„ ì•ˆë‚´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\nâ° ì˜ˆìƒ ì²˜ë¦¬ ì‹œê°„: 1-3ì¼\nğŸ“ ê¸´ê¸‰í•œ ê²½ìš° ê´€ë¦¬ì‚¬ë¬´ì†Œ(02-1234-5678)ë¡œ ì—°ë½í•´ ì£¼ì„¸ìš”."
            },
            parking: {
                title: "ì£¼ì°¨ ë¬¸ì œ",
                steps: [
                    {
                        question: "ì£¼ì°¨ ê´€ë ¨ ì–´ë–¤ ë¬¸ì œì¸ê°€ìš”?\n1ï¸âƒ£ ë¶ˆë²• ì£¼ì°¨\n2ï¸âƒ£ ë°©ë¬¸ì°¨ëŸ‰ ë“±ë¡\n3ï¸âƒ£ ì „ê¸°ì°¨ ì¶©ì „\n4ï¸âƒ£ ì£¼ì°¨ê¶Œ ë¬¸ì˜\n5ï¸âƒ£ ê¸°íƒ€",
                        options: ["ë¶ˆë²• ì£¼ì°¨", "ë°©ë¬¸ì°¨ëŸ‰ ë“±ë¡", "ì „ê¸°ì°¨ ì¶©ì „", "ì£¼ì°¨ê¶Œ ë¬¸ì˜", "ê¸°íƒ€"]
                    },
                    {
                        question: "ì •í™•í•œ ìœ„ì¹˜ë¥¼ ì•Œë ¤ì£¼ì„¸ìš” (ì˜ˆ: ì§€í•˜1ì¸µ Aêµ¬ì—­, 101ë™ ì•)",
                        field: "location"
                    },
                    {
                        question: "ì°¨ëŸ‰ ë²ˆí˜¸ë¥¼ ì•Œê³  ê³„ì‹ ê°€ìš”? (ì•Œê³  ìˆë‹¤ë©´ ì•Œë ¤ì£¼ì„¸ìš”)",
                        field: "vehicleNumber"
                    }
                ],
                completion: "ğŸš— ì£¼ì°¨ ê´€ë¦¬ ë‹´ë‹¹ìê°€ í™•ì¸ í›„ ì¡°ì¹˜í•˜ê² ìŠµë‹ˆë‹¤.\nâš ï¸ ë¶ˆë²• ì£¼ì°¨ì˜ ê²½ìš° ê²½ê³ ì¥ ë°œì†¡ ì˜ˆì •ì…ë‹ˆë‹¤.\nâ° ì²˜ë¦¬ ì˜ˆìƒ ì‹œê°„: ë‹¹ì¼ ì¤‘"
            },
            emergency: {
                title: "ê¸´ê¸‰ìƒí™©",
                steps: [
                    {
                        question: "ì–´ë–¤ ê¸´ê¸‰ìƒí™©ì¸ê°€ìš”?\n1ï¸âƒ£ ì •ì „\n2ï¸âƒ£ ë‹¨ìˆ˜\n3ï¸âƒ£ ê¸‰ìˆ˜ ë¶ˆëŸ‰\n4ï¸âƒ£ ë‚œë°©/ì˜¨ìˆ˜ ë¶ˆëŸ‰\n5ï¸âƒ£ ê°€ìŠ¤ ëˆ„ì¶œ\n6ï¸âƒ£ í™”ì¬\n7ï¸âƒ£ ê¸°íƒ€",
                        options: ["ì •ì „", "ë‹¨ìˆ˜", "ê¸‰ìˆ˜ ë¶ˆëŸ‰", "ë‚œë°©/ì˜¨ìˆ˜ ë¶ˆëŸ‰", "ê°€ìŠ¤ ëˆ„ì¶œ", "í™”ì¬", "ê¸°íƒ€"]
                    },
                    {
                        question: "ì˜í–¥ ë²”ìœ„ëŠ” ì–´ë–»ê²Œ ë˜ë‚˜ìš”?\n1ï¸âƒ£ ìš°ë¦¬ ì§‘ë§Œ\n2ï¸âƒ£ ê°™ì€ ì¸µ\n3ï¸âƒ£ ê°™ì€ ë™\n4ï¸âƒ£ ë‹¨ì§€ ì „ì²´\n5ï¸âƒ£ ëª¨ë¦„",
                        options: ["ìš°ë¦¬ ì§‘ë§Œ", "ê°™ì€ ì¸µ", "ê°™ì€ ë™", "ë‹¨ì§€ ì „ì²´", "ëª¨ë¦„"]
                    },
                    {
                        question: "ì–¸ì œë¶€í„° ë¬¸ì œê°€ ì‹œì‘ë˜ì—ˆë‚˜ìš”? (ì˜ˆ: ë°©ê¸ˆ ì „, 30ë¶„ ì „, ì˜¤ëŠ˜ ì•„ì¹¨)",
                        field: "startTime"
                    }
                ],
                completion: "ğŸš¨ ê¸´ê¸‰ìƒí™©ìœ¼ë¡œ ë¶„ë¥˜ë˜ì–´ ì¦‰ì‹œ ë‹´ë‹¹ìì—ê²Œ ì „ë‹¬ë©ë‹ˆë‹¤.\nğŸ“ ì¶”ê°€ ì—°ë½ì´ í•„ìš”í•œ ê²½ìš° ê´€ë¦¬ì‚¬ë¬´ì†Œ(02-1234-5678)ë¡œ ì—°ë½í•´ ì£¼ì„¸ìš”.\nâš¡ ì¦‰ì‹œ ì²˜ë¦¬ ì˜ˆì •"
            }
        };

        // Generic message history function
        function addMessageToHistory(sender, message, isUser = false, historyId = 'conversationHistory', channelStyle = 'default') {
            const history = document.getElementById(historyId);
            if (!history) return;

            const messageDiv = document.createElement('div');
            messageDiv.className = `mb-3 ${isUser ? 'text-right' : 'text-left'}`;

            let bubbleClass = '';
            let senderClass = '';

            if (channelStyle === 'sms') {
                bubbleClass = isUser
                    ? 'bg-green-500 text-white'
                    : 'bg-gray-100 border border-gray-300 text-gray-800';
                senderClass = isUser ? 'text-green-100' : 'text-gray-500';
            } else if (channelStyle === 'kakao') {
                bubbleClass = isUser
                    ? 'bg-yellow-400 text-gray-800'
                    : 'bg-white border border-yellow-300 text-gray-800';
                senderClass = isUser ? 'text-yellow-800' : 'text-gray-500';
            } else {
                bubbleClass = isUser
                    ? 'bg-blue-500 text-white'
                    : 'bg-white border border-gray-200 text-gray-800';
                senderClass = isUser ? 'text-blue-100' : 'text-gray-500';
            }

            const bubble = document.createElement('div');
            bubble.className = `inline-block max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${bubbleClass}`;

            const senderSpan = document.createElement('div');
            senderSpan.className = `text-xs ${senderClass} mb-1`;
            senderSpan.textContent = sender;

            const messageSpan = document.createElement('div');
            messageSpan.className = 'text-sm whitespace-pre-line';
            messageSpan.textContent = message;

            bubble.appendChild(senderSpan);
            bubble.appendChild(messageSpan);
            messageDiv.appendChild(bubble);
            history.appendChild(messageDiv);

            // Scroll to bottom
            history.scrollTop = history.scrollHeight;
        }

        // SMS Conversation Functions
        function startSMSConversation(type) {
            currentSMSConversation = conversationFlows[type];
            smsConversationStep = 0;

            // Clear history
            const history = document.getElementById('smsConversationHistory');
            if (history) {
                history.innerHTML = '';
            }

            // Add initial message
            addMessageToHistory('010-1234-5678', `${currentSMSConversation.title} ë¬¸ì˜ë“œë¦½ë‹ˆë‹¤.`, true, 'smsConversationHistory', 'sms');

            setTimeout(() => {
                addMessageToHistory('AI ë¹„ì„œ', 'ğŸ“ ë” ì •í™•í•œ ì²˜ë¦¬ë¥¼ ìœ„í•´ ëª‡ ê°€ì§€ ì§ˆë¬¸ë“œë¦¬ê² ìŠµë‹ˆë‹¤.', false, 'smsConversationHistory', 'sms');
                setTimeout(() => {
                    askNextSMSQuestion();
                }, 1000);
            }, 500);

            // Enable input
            const userResponse = document.getElementById('smsUserResponse');
            const sendResponse = document.getElementById('sendSMSResponse');
            if (userResponse) {
                userResponse.disabled = false;
                userResponse.focus();
            }
            if (sendResponse) {
                sendResponse.disabled = false;
            }
        }

        function askNextSMSQuestion() {
            if (!currentSMSConversation || smsConversationStep >= currentSMSConversation.steps.length) {
                completeSMSConversation();
                return;
            }

            const step = currentSMSConversation.steps[smsConversationStep];
            addMessageToHistory('AI ë¹„ì„œ', step.question, false, 'smsConversationHistory', 'sms');
        }

        function processSMSUserResponse() {
            const userInput = document.getElementById('smsUserResponse');
            if (!userInput || !userInput.value.trim()) return;

            const inputValue = userInput.value.trim();

            // Add user message
            addMessageToHistory('010-1234-5678', inputValue, true, 'smsConversationHistory', 'sms');

            // Clear input
            userInput.value = '';

            // Move to next step
            smsConversationStep++;

            setTimeout(() => {
                askNextSMSQuestion();
            }, 1000);
        }

        function completeSMSConversation() {
            setTimeout(() => {
                addMessageToHistory('AI ë¹„ì„œ', 'âœ… ì •ë³´ ìˆ˜ì§‘ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', false, 'smsConversationHistory', 'sms');
                setTimeout(() => {
                    addMessageToHistory('AI ë¹„ì„œ', currentSMSConversation.completion, false, 'smsConversationHistory', 'sms');

                    // Disable input
                    const userResponse = document.getElementById('smsUserResponse');
                    const sendResponse = document.getElementById('sendSMSResponse');
                    if (userResponse) userResponse.disabled = true;
                    if (sendResponse) sendResponse.disabled = true;

                    currentSMSConversation = null;
                    smsConversationStep = 0;
                }, 1000);
            }, 500);
        }

        // KakaoTalk Conversation Functions
        function startKakaoConversation(type) {
            currentKakaoConversation = conversationFlows[type];
            kakaoConversationStep = 0;

            // Clear history
            const history = document.getElementById('kakaoConversationHistory');
            if (history) {
                history.innerHTML = '';
            }

            // Add initial message
            addMessageToHistory('ì‚¬ìš©ì', `${currentKakaoConversation.title} ë¬¸ì˜ë“œë¦½ë‹ˆë‹¤.`, true, 'kakaoConversationHistory', 'kakao');

            setTimeout(() => {
                addMessageToHistory('AI ë¹„ì„œ', 'ğŸ“ ë” ì •í™•í•œ ì²˜ë¦¬ë¥¼ ìœ„í•´ ëª‡ ê°€ì§€ ì§ˆë¬¸ë“œë¦¬ê² ìŠµë‹ˆë‹¤.', false, 'kakaoConversationHistory', 'kakao');
                setTimeout(() => {
                    askNextKakaoQuestion();
                }, 1000);
            }, 500);

            // Enable input
            const userResponse = document.getElementById('kakaoUserResponse');
            const sendResponse = document.getElementById('sendKakaoResponse');
            if (userResponse) {
                userResponse.disabled = false;
                userResponse.focus();
            }
            if (sendResponse) {
                sendResponse.disabled = false;
            }
        }

        function askNextKakaoQuestion() {
            if (!currentKakaoConversation || kakaoConversationStep >= currentKakaoConversation.steps.length) {
                completeKakaoConversation();
                return;
            }

            const step = currentKakaoConversation.steps[kakaoConversationStep];
            addMessageToHistory('AI ë¹„ì„œ', step.question, false, 'kakaoConversationHistory', 'kakao');

            // Add quick response buttons for KakaoTalk
            if (step.options) {
                setTimeout(() => {
                    addKakaoQuickResponseButtons(step.options);
                }, 500);
            }
        }

        function addKakaoQuickResponseButtons(options) {
            const history = document.getElementById('kakaoConversationHistory');
            if (!history) return;

            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'mb-3 text-left';
            buttonContainer.id = 'kakaoQuickButtons';

            const buttonsDiv = document.createElement('div');
            buttonsDiv.className = 'flex flex-wrap gap-2 mt-2';

            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'bg-yellow-100 hover:bg-yellow-200 text-yellow-800 px-3 py-1 rounded-full text-sm border border-yellow-300';
                button.textContent = option;
                button.onclick = () => {
                    const userResponse = document.getElementById('kakaoUserResponse');
                    if (userResponse) {
                        userResponse.value = option;
                        processKakaoUserResponse();
                    }
                };
                buttonsDiv.appendChild(button);
            });

            buttonContainer.appendChild(buttonsDiv);
            history.appendChild(buttonContainer);
            history.scrollTop = history.scrollHeight;
        }

        function processKakaoUserResponse() {
            const userInput = document.getElementById('kakaoUserResponse');
            if (!userInput || !userInput.value.trim()) return;

            const inputValue = userInput.value.trim();

            // Remove quick buttons
            const quickButtons = document.getElementById('kakaoQuickButtons');
            if (quickButtons) {
                quickButtons.remove();
            }

            // Add user message
            addMessageToHistory('ì‚¬ìš©ì', inputValue, true, 'kakaoConversationHistory', 'kakao');

            // Clear input
            userInput.value = '';

            // Move to next step
            kakaoConversationStep++;

            setTimeout(() => {
                askNextKakaoQuestion();
            }, 1000);
        }

        function completeKakaoConversation() {
            setTimeout(() => {
                addMessageToHistory('AI ë¹„ì„œ', 'âœ… ì •ë³´ ìˆ˜ì§‘ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', false, 'kakaoConversationHistory', 'kakao');
                setTimeout(() => {
                    addMessageToHistory('AI ë¹„ì„œ', currentKakaoConversation.completion, false, 'kakaoConversationHistory', 'kakao');

                    // Disable input
                    const userResponse = document.getElementById('kakaoUserResponse');
                    const sendResponse = document.getElementById('sendKakaoResponse');
                    if (userResponse) userResponse.disabled = true;
                    if (sendResponse) sendResponse.disabled = true;

                    currentKakaoConversation = null;
                    kakaoConversationStep = 0;
                }, 1000);
            }, 500);
        }

        function startConversation(type) {
            currentConversation = conversationFlows[type];
            conversationStep = 0;

            // Clear history
            const history = document.getElementById('conversationHistory');
            if (history) {
                history.innerHTML = '';
            }

            // Add initial message
            addMessageToHistory('ì‚¬ìš©ì', `${currentConversation.title} ë¬¸ì˜ë“œë¦½ë‹ˆë‹¤.`, true);

            setTimeout(() => {
                addMessageToHistory('AI ë¹„ì„œ', 'ğŸ“ ë” ì •í™•í•œ ì²˜ë¦¬ë¥¼ ìœ„í•´ ëª‡ ê°€ì§€ ì§ˆë¬¸ë“œë¦¬ê² ìŠµë‹ˆë‹¤.');
                setTimeout(() => {
                    askNextQuestion();
                }, 1000);
            }, 500);

            // Enable input
            const userResponse = document.getElementById('userResponse');
            const sendResponse = document.getElementById('sendResponse');
            if (userResponse) {
                userResponse.disabled = false;
                userResponse.focus();
            }
            if (sendResponse) {
                sendResponse.disabled = false;
            }
        }

        function askNextQuestion() {
            if (!currentConversation || conversationStep >= currentConversation.steps.length) {
                completeConversation();
                return;
            }

            const step = currentConversation.steps[conversationStep];
            addMessageToHistory('AI ë¹„ì„œ', step.question);

            // Add quick response buttons if options exist
            if (step.options) {
                setTimeout(() => {
                    addQuickResponseButtons(step.options);
                }, 500);
            }
        }

        function addQuickResponseButtons(options) {
            const history = document.getElementById('conversationHistory');
            if (!history) return;

            const buttonContainer = document.createElement('div');
            buttonContainer.className = 'mb-3 text-left';
            buttonContainer.id = 'quickButtons';

            const buttonsDiv = document.createElement('div');
            buttonsDiv.className = 'flex flex-wrap gap-2 mt-2';

            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-full text-sm border';
                button.textContent = option;
                button.onclick = () => {
                    const userResponse = document.getElementById('userResponse');
                    if (userResponse) {
                        userResponse.value = option;
                        processUserResponse();
                    }
                };
                buttonsDiv.appendChild(button);
            });

            buttonContainer.appendChild(buttonsDiv);
            history.appendChild(buttonContainer);
            history.scrollTop = history.scrollHeight;
        }

        function processUserResponse() {
            const userInput = document.getElementById('userResponse');
            if (!userInput || !userInput.value.trim()) return;

            const inputValue = userInput.value.trim();

            // Remove quick buttons
            const quickButtons = document.getElementById('quickButtons');
            if (quickButtons) {
                quickButtons.remove();
            }

            // Add user message
            addMessageToHistory('ì‚¬ìš©ì', inputValue, true);

            // Clear input
            userInput.value = '';

            // Move to next step
            conversationStep++;

            setTimeout(() => {
                askNextQuestion();
            }, 1000);
        }

        function completeConversation() {
            setTimeout(() => {
                addMessageToHistory('AI ë¹„ì„œ', 'âœ… ì •ë³´ ìˆ˜ì§‘ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                setTimeout(() => {
                    addMessageToHistory('AI ë¹„ì„œ', currentConversation.completion);

                    // Disable input
                    const userResponse = document.getElementById('userResponse');
                    const sendResponse = document.getElementById('sendResponse');
                    if (userResponse) userResponse.disabled = true;
                    if (sendResponse) sendResponse.disabled = true;

                    currentConversation = null;
                    conversationStep = 0;
                }, 1000);
            }, 500);
        }

        // Event listeners for all conversation simulators
        document.addEventListener('DOMContentLoaded', function () {
            // Main AI Conversation Simulator
            const startNoiseBtn = document.getElementById('startNoiseConversation');
            const startFacilityBtn = document.getElementById('startFacilityConversation');
            const startParkingBtn = document.getElementById('startParkingConversation');
            const startEmergencyBtn = document.getElementById('startEmergencyConversation');
            const conversationForm = document.getElementById('conversationResponseForm');
            const clearBtn = document.getElementById('clearConversation');

            if (startNoiseBtn) startNoiseBtn.addEventListener('click', () => startConversation('noise'));
            if (startFacilityBtn) startFacilityBtn.addEventListener('click', () => startConversation('facility'));
            if (startParkingBtn) startParkingBtn.addEventListener('click', () => startConversation('parking'));
            if (startEmergencyBtn) startEmergencyBtn.addEventListener('click', () => startConversation('emergency'));

            if (conversationForm) {
                conversationForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    processUserResponse();
                });
            }

            if (clearBtn) {
                clearBtn.addEventListener('click', function () {
                    const history = document.getElementById('conversationHistory');
                    const userResponse = document.getElementById('userResponse');
                    const sendResponse = document.getElementById('sendResponse');

                    if (history) {
                        history.innerHTML = '<div class="text-sm text-gray-500 text-center">ëŒ€í™” ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>';
                    }
                    if (userResponse) {
                        userResponse.disabled = true;
                        userResponse.value = '';
                    }
                    if (sendResponse) {
                        sendResponse.disabled = true;
                    }

                    currentConversation = null;
                    conversationStep = 0;
                });
            }

            // SMS Conversation Simulator
            const startSMSNoiseBtn = document.getElementById('startSMSNoise');
            const startSMSFacilityBtn = document.getElementById('startSMSFacility');
            const startSMSParkingBtn = document.getElementById('startSMSParking');
            const startSMSEmergencyBtn = document.getElementById('startSMSEmergency');
            const smsConversationForm = document.getElementById('smsConversationForm');
            const clearSMSBtn = document.getElementById('clearSMSConversation');

            if (startSMSNoiseBtn) startSMSNoiseBtn.addEventListener('click', () => startSMSConversation('noise'));
            if (startSMSFacilityBtn) startSMSFacilityBtn.addEventListener('click', () => startSMSConversation('facility'));
            if (startSMSParkingBtn) startSMSParkingBtn.addEventListener('click', () => startSMSConversation('parking'));
            if (startSMSEmergencyBtn) startSMSEmergencyBtn.addEventListener('click', () => startSMSConversation('emergency'));

            if (smsConversationForm) {
                smsConversationForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    processSMSUserResponse();
                });
            }

            if (clearSMSBtn) {
                clearSMSBtn.addEventListener('click', function () {
                    const history = document.getElementById('smsConversationHistory');
                    const userResponse = document.getElementById('smsUserResponse');
                    const sendResponse = document.getElementById('sendSMSResponse');

                    if (history) {
                        history.innerHTML = '<div class="text-sm text-gray-500 text-center">SMS ëŒ€í™” ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>';
                    }
                    if (userResponse) {
                        userResponse.disabled = true;
                        userResponse.value = '';
                    }
                    if (sendResponse) {
                        sendResponse.disabled = true;
                    }

                    currentSMSConversation = null;
                    smsConversationStep = 0;
                });
            }

            // KakaoTalk Conversation Simulator
            const startKakaoNoiseBtn = document.getElementById('startKakaoNoise');
            const startKakaoFacilityBtn = document.getElementById('startKakaoFacility');
            const startKakaoParkingBtn = document.getElementById('startKakaoParking');
            const startKakaoEmergencyBtn = document.getElementById('startKakaoEmergency');
            const kakaoConversationForm = document.getElementById('kakaoConversationForm');
            const clearKakaoBtn = document.getElementById('clearKakaoConversation');

            if (startKakaoNoiseBtn) startKakaoNoiseBtn.addEventListener('click', () => startKakaoConversation('noise'));
            if (startKakaoFacilityBtn) startKakaoFacilityBtn.addEventListener('click', () => startKakaoConversation('facility'));
            if (startKakaoParkingBtn) startKakaoParkingBtn.addEventListener('click', () => startKakaoConversation('parking'));
            if (startKakaoEmergencyBtn) startKakaoEmergencyBtn.addEventListener('click', () => startKakaoConversation('emergency'));

            if (kakaoConversationForm) {
                kakaoConversationForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    processKakaoUserResponse();
                });
            }

            if (clearKakaoBtn) {
                clearKakaoBtn.addEventListener('click', function () {
                    const history = document.getElementById('kakaoConversationHistory');
                    const userResponse = document.getElementById('kakaoUserResponse');
                    const sendResponse = document.getElementById('sendKakaoResponse');

                    if (history) {
                        history.innerHTML = '<div class="text-sm text-gray-500 text-center">ì¹´ì¹´ì˜¤í†¡ ëŒ€í™” ê¸°ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>';
                    }
                    if (userResponse) {
                        userResponse.disabled = true;
                        userResponse.value = '';
                    }
                    if (sendResponse) {
                        sendResponse.disabled = true;
                    }

                    currentKakaoConversation = null;
                    kakaoConversationStep = 0;
                });
            }
        });

        // Script loaded successfully
        console.log('âœ… JavaScript loaded successfully - no syntax errors');
    </script>
</body>

</html>